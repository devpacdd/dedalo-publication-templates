var page={page_title:null,menu_data:null,row:null,area_name:null,init:function(){const e=this;return new Promise((function(n){e.area_name=window.location.pathname.split("/").slice(1).pop()||"main_home",console.log("self.area_name:",e.area_name),e.load_menu_data().then((function(t){if(console.log("menu_data:",e.area_name,t),e.menu_data=t,e.menu_data)if(e.row=e.menu_data.find((function(n){return n.web_path===e.area_name})),console.log("self.row:",e.row),e.row){const n=document.getElementById("template");e.render_template(n)}else console.error("ERROR 404: page '"+area_name+"' not found! Available pages (web_path):",e.menu_data.map(e=>e.web_path));n(!0)}))}))},render_lang_selector:function(){const e=new DocumentFragment,n=common.create_dom_element({element_type:"ul",class_name:"lang_selector",parent:e}),t=environment.lang;for(let e=0;e<environment.langs.length;e++){const a=environment.langs[e],o=common.create_dom_element({element_type:"li",parent:n});common.create_dom_element({element_type:"a",inner_html:a.label,class_name:a.code===t?"selected":"",parent:o}).addEventListener("click",(function(e){e.preventDefault(),environment.set_local_user_config({lang:a.code}),location.reload()}))}return e},load_menu_data:function(){const e=this;return new Promise((function(n){const t={dedalo_get:"records",table:environment.table_menu,ar_fields:["*"],sql_filter:environment.table_menu_filter||null,limit:0,count:!1,offset:0,order:"norder ASC"};data_manager.request({body:t}).then((function(t){e.parse_menu_data(t.result);n(t.result)}))}))},parse_menu_data:function(e){if(e)for(let n=e.length-1;n>=0;n--){const t=e[n];t.children=t.children?JSON.parse(t.children):null,t.web_path=t.web_path?t.web_path:t.term_id}return e},render_menu:function(){const e=this,n=new DocumentFragment;function t(e){const t=common.create_dom_element({element_type:"li",parent:n});if(t.parent_term_id=e.parent,t.term_id=e.term_id,"yes"===e.active){common.create_dom_element({element_type:"a",class_name:"",inner_html:e.term,href:e.web_path,parent:t})}return t}const a=[];for(let n=0;n<e.menu_data.length;n++){const o=e.menu_data[n];if(o.term_id!==environment.menu_global_page&&"yes"===o.menu){const e=t(o);a.push(e)}}for(let e=0;e<n.childNodes.length;e++){const t=n.childNodes[e];if(t.parent_term_id&&t.parent_term_id.length>0){const e=a.find((function(e){return e.term_id===t.parent_term_id}));if(e){(e.lastChild&&"UL"===e.lastChild.tagName?e.lastChild:common.create_dom_element({element_type:"ul",class_name:"icon solid fa-angle-down "+t.term_id,parent:e})).appendChild(t)}}}const o=common.create_dom_element({element_type:"ul",class_name:"menu"});return o.appendChild(n),o},load_template_files:function(){const e=this;return new Promise((function(n){const t=e.row.template_name;console.log("template_name:",t);const a=["./tpl/"+t+"/css/"+t+".css"],o=document.getElementsByTagName("head")[0];for(let e=0;e<a.length;e++){const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=a[e]+"?"+version,o.appendChild(n)}const l=["./tpl/"+t+"/js/"+t+".js"],r=[];for(let e=0;e<l.length;e++)r.push(new Promise((function(n,t){const a=document.createElement("script");a.src=l[e]+"?"+version,a.addEventListener("load",(function(){n(!0)})),document.body.appendChild(a)})));Promise.all(r).then(()=>{n(!0)})}))},render_template:function(e){const n=this;return new Promise((function(t){n.load_template_files().then((function(a){const o=window[n.row.template_name];o.init({row:n.row}).then((function(n){const a=o.render();a&&e.appendChild(a),t(a)}))}))}))}};